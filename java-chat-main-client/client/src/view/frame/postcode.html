<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>우편번호 찾기</title>
</head>
<body>
    <div id="embed-postcode" style="width:100%;height:400px;margin:0;padding:0"></div>

    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script>
        window.bridgeIsReady = false;
        window.onload = function() {
            new daum.Postcode({
                oncomplete: function(data) {

                    function checkReadyAndCall(postcode, address, attempt) {
                        if (window.bridgeIsReady && window.javaBridge) { 
                            console.log("Java 준비 완료 신호 받음! 자바 코드 호출 시도...");
                            window.javaBridge.addressSelected(postcode, address);
                        } else if (attempt < 15) { // 최대 1.5초 기다림
                            console.log("Java 준비 신호 기다리는 중... 재시도: " + attempt 
                            		+ " (Ready 신호: " + window.bridgeIsReady + ")");
                            setTimeout(function() {
                                checkReadyAndCall(postcode, address, attempt + 1);
                            }, 100); 
                        } else {
                            alert("오류: Java 준비 신호를 받지 못했습니다. 창을 닫고 다시 시도해 주세요.");
                        }
                    }
                    checkReadyAndCall(data.zonecode, data.roadAddress, 1);

                },
                width : '100%',
                height : '100%'
            }).embed(document.getElementById('embed-postcode'));
        }
    </script>
</body>
</html>